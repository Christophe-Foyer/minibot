services:
  roscore:
    image: ros:noetic-ros-core
    container_name: roscore
    command: roscore
    network_mode: host
    restart: unless-stopped

  vzense_camera:
    build:
      dockerfile: Dockerfile.dcam710-ros
    privileged: true
    cap_add:
      - SYS_ADMIN
    container_name: vzense_camera
    depends_on:
      - roscore
    network_mode: host
    devices:
      - "/dev/bus/usb:/dev/bus/usb"   # pass USB device
    restart: unless-stopped

  ros1_bridge:
    image: ros:galactic-ros1-bridge
    container_name: ros1_bridge
    depends_on: [roscore]
    network_mode: host  # needed for ROS1<->ROS2
    command: >
      bash -c "
        source /opt/ros/noetic/setup.bash &&
        source /opt/ros/galactic/setup.bash &&
        ros2 run ros1_bridge dynamic_bridge
      "
